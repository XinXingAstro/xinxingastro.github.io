<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Comic Sans MS:300,300italic,400,400italic,700,700italic|Pacifico:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xinxingastro.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"manual"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Spring框架的学习笔记。">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring框架学习笔记">
<meta property="og:url" content="https://xinxingastro.github.io/2018/07/18/Java-Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Xing&#39;s Techlog">
<meta property="og:description" content="Spring框架的学习笔记。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xinxingastro.github.io/2018/07/18/Java-Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/SpringFactory.png">
<meta property="article:published_time" content="2018-07-18T13:57:44.000Z">
<meta property="article:modified_time" content="2020-04-23T02:40:48.796Z">
<meta property="article:author" content="Xing Xin">
<meta property="article:tag" content="Tech">
<meta property="article:tag" content=" Algorithm">
<meta property="article:tag" content=" Data Structure">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xinxingastro.github.io/2018/07/18/Java-Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/SpringFactory.png">

<link rel="canonical" href="https://xinxingastro.github.io/2018/07/18/Java-Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Spring框架学习笔记 | Xing's Techlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xing's Techlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/XinXingAstro" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://xinxingastro.github.io/2018/07/18/Java-Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/16800212?s=460&v=4">
      <meta itemprop="name" content="Xing Xin">
      <meta itemprop="description" content="Xing's Tech Blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xing's Techlog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring框架学习笔记<a href="https://github.com/XinXingAstro/xinxingastro.github.io/edit/source/source/_posts/Java/Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md" class="post-edit-link" title="Edit this post" rel="noopener" target="_blank"><i class="fa fa-pencil-alt"></i></a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-18 21:57:44" itemprop="dateCreated datePublished" datetime="2018-07-18T21:57:44+08:00">2018-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-23 10:40:48" itemprop="dateModified" datetime="2020-04-23T10:40:48+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/07/18/Java-Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/07/18/Java-Spring框架学习笔记/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Spring框架的学习笔记。</p>
<a id="more"></a>
<hr />
<h2 id="iocinversion-of-control控制反转"><a class="markdownIt-Anchor" href="#iocinversion-of-control控制反转"></a> IoC(Inversion of Control)控制反转</h2>
<h3 id="ioc的概念"><a class="markdownIt-Anchor" href="#ioc的概念"></a> IoC的概念</h3>
<p>IoC(Inversion of Control)控制反转，又叫DI(Dependency Injection)依赖注入，是一个流程，对象可以通过这个流程来定义他们在运行时需要用到的其他对象（依赖），这些依赖的对象可以是构造方法中的参数，可以是工厂方法的返回值，可以是一个带有set方法的property。IoC容器在创建bean的时候将这些依赖注入到这个bean中。这个流程和正常流程是相反的，既我们将创将对象和注入依赖的控制权交给了容器，所以叫作控制反转。</p>
<h3 id="ioc的底层实现"><a class="markdownIt-Anchor" href="#ioc的底层实现"></a> IoC的底层实现</h3>
<p>面向类的编程 =&gt; 面向接口的编程 =&gt; 工厂模式 =&gt; 工厂模式+反射+配置文件实现程序解耦</p>
<p>传统方式我们面向类编程，一个类型的引用只能对应该类型的对象例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyClass myClass = <span class="keyword">new</span> MyClass();</span><br></pre></td></tr></table></figure>
<p>经过改进后我们面向接口编程，一个接口类型的引用可以指向实现该接口的多种类型对象（多态）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyInterface myClass = <span class="keyword">new</span> MyClassImplMyInterface();</span><br></pre></td></tr></table></figure>
<p>这样接口和实现类耦合度过高，当我们要换其他实现类的时候必须修改源码。</p>
<p>为了满足程序设计的OCP原则，在尽量不修改程序源码的基础上对程序进行扩展，我们使用工厂模式，创建工厂类，利用工厂得到对应的对象，这时接口和实现类没有了耦合，但是当我们要更换实现类的时候需要修改工厂里的代码。</p>
<p>Spring IoC容器的出现让我们只需要修改配置文件，就可以轻松的替换一个bean对象的实现类，Ioc容器通过解析xml文件中bean的配置信息，拿到需要创建bean对象的类型信息，然后使用工厂类通过反射创建该类型的实例然后返回给用户。当我们需要修改一个bean的实现类的时候，只需要修改xml配置文件就可以了。</p>
<p>Ioc控制翻转：将创建对象的控制权交由Ioc容器管理。</p>
<p>DI依赖注入：在创建对象时自动注入对象的依赖，如设置属性的值。</p>
<h3 id="spring的工厂类"><a class="markdownIt-Anchor" href="#spring的工厂类"></a> Spring的工厂类</h3>
<p>BeanFactory: 老版本工厂类</p>
<p>ApplicationContext: 新版本工厂类，现在都用新版本的。</p>
<h4 id="spring工厂类的结构"><a class="markdownIt-Anchor" href="#spring工厂类的结构"></a> Spring工厂类的结构</h4>
<p><img src="SpringFactory.png" alt="SpringFactory" /></p>
<p>ApplicationContext接口继承了BeanFactory接口，BeanFactory和ApplicationContext的区别：</p>
<ul>
<li>BeanFactory在调用getBean()方法的时候才会生成类的实例。</li>
<li>ApplicationContex在加载配置文件的时候就将Spring管理的类实例化。</li>
</ul>
<h4 id="最底层的两个实现类"><a class="markdownIt-Anchor" href="#最底层的两个实现类"></a> 最底层的两个实现类</h4>
<p>ClassPathXmlApplicationContext: 用来加载类路径下的xml配置文件。</p>
<p>FileSystemXmlApplicationContext: 用来加载磁盘上的xml配置文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">MyClass myClass = (MyClass)applicationContext.getBean(<span class="string">"MyClassBeanID"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="bean的创建"><a class="markdownIt-Anchor" href="#bean的创建"></a> Bean的创建</h3>
<h4 id="1无参构造方法默认"><a class="markdownIt-Anchor" href="#1无参构造方法默认"></a> 1）无参构造方法（默认）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Bean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Bean的无参构造方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.Bean"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2静态工厂实例化方式"><a class="markdownIt-Anchor" href="#2静态工厂实例化方式"></a> 2）静态工厂实例化方式：</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticBeanFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bean <span class="title">staticBeanFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Bean的静态实例化工厂</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Bean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.StaticBeanFactory"</span> <span class="attr">factory-method</span>=<span class="string">"staticBeanFactory"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3实例化工厂实例化方式"><a class="markdownIt-Anchor" href="#3实例化工厂实例化方式"></a> 3）实例化工厂实例化方式</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bean <span class="title">beanFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Bean的实例化工厂</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Bean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beanFactory"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.BeanFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean"</span> <span class="attr">factory-bean</span>=<span class="string">"beanFactory"</span> <span class="attr">factory-method</span>=<span class="string">"beanFactory"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="bean的配置"><a class="markdownIt-Anchor" href="#bean的配置"></a> Bean的配置</h3>
<h4 id="bean的idname配置"><a class="markdownIt-Anchor" href="#bean的idname配置"></a> Bean的id，name配置</h4>
<p>id: 使用了唯一约束，里面不能出现特殊字符。</p>
<p>name: 没有唯一约束，可以出现特殊字符，通常会在Spring和struts1框架整合时遇到。</p>
<h4 id="bean生命周期的配置"><a class="markdownIt-Anchor" href="#bean生命周期的配置"></a> Bean生命周期的配置</h4>
<p>init-method: Bean版初始化时候执行的方法。</p>
<p>destroy-methos：Bean被关闭时候执行的方法。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.xinxng.Person"</span> <span class="attr">init-method</span>=<span class="string">"myInitMethod"</span> <span class="attr">destroy-method</span>=<span class="string">"myDestroyMethod"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="bean的作用范围的配置"><a class="markdownIt-Anchor" href="#bean的作用范围的配置"></a> Bean的作用范围的配置</h4>
<p>scope：Bean的作用范围</p>
<ul>
<li>singleton：默认的，Spring会采用单例模式创建这个对象。</li>
<li>prototype：多例模式。</li>
<li>request：应用在web项目中，Spring创建Bean后会放入到request范围中。</li>
<li>session：应用在web项目中，Spring创建Bean后会放入到session范围中。</li>
<li>globalsession：应用在web项目中，必须在porlet环境下使用。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person"</span> <span class="attr">class</span>=<span class="string">"com.xinxng.Person"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="基于配置文件的属性注入"><a class="markdownIt-Anchor" href="#基于配置文件的属性注入"></a> 基于配置文件的属性注入</h3>
<h4 id="1导入6个spring核心开发包"><a class="markdownIt-Anchor" href="#1导入6个spring核心开发包"></a> 1）导入6个Spring核心开发包</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring-bean-x.x.x.RELEASE.jar</span><br><span class="line">spring-context-x.x.x.RELEASE.jar</span><br><span class="line">spring-core-x.x.x.RELEASE.jar</span><br><span class="line">spring-expression-x.x.x.RELEASE.jar</span><br><span class="line">com.springsource.org.apache.commons.logging-x.x.x.jar</span><br><span class="line">com.springsource.org.apache.log4j-x.x.x.jar</span><br></pre></td></tr></table></figure>
<h4 id="2配置xml文件约束"><a class="markdownIt-Anchor" href="#2配置xml文件约束"></a> 2）配置XML文件约束</h4>
<p>导入<strong>beans</strong>约束，参考官方文档：<a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#xsd-schemas-beans">9.1.4. The beans schema</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"foo"</span> <span class="attr">class</span>=<span class="string">"x.y.Foo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">key</span>=<span class="string">"cacheName"</span> <span class="attr">value</span>=<span class="string">"foo"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"Rick"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="普通类型属性注入方法"><a class="markdownIt-Anchor" href="#普通类型属性注入方法"></a> 普通类型属性注入方法</h4>
<h5 id="1构造方法的属性注入"><a class="markdownIt-Anchor" href="#1构造方法的属性注入"></a> 1）构造方法的属性注入</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Person child;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age, Person child)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.child = child;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(name + age + child);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person1"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span>, <span class="attr">value</span>=<span class="string">"xinxing"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span>, <span class="attr">value</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"child"</span>, <span class="attr">ref</span>=<span class="string">"childID"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2set方法的属性注入"><a class="markdownIt-Anchor" href="#2set方法的属性注入"></a> 2）set方法的属性注入</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Person child;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(Person child)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.child = child;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(name + age + child);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person2"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.Person"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- value用来指定普通类型的值，ref用来指定对象的引用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"xinxing"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"child"</span> <span class="attr">ref</span>=<span class="string">"person1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="3p名称空间的属性注入spring-25-以后"><a class="markdownIt-Anchor" href="#3p名称空间的属性注入spring-25-以后"></a> 3）P名称空间的属性注入(Spring 2.5 以后)</h5>
<p>添加p名称空间约束<code>xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person3"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.Person"</span> <span class="attr">p:name</span>=<span class="string">"xinxing"</span> <span class="attr">p:age</span>=<span class="string">"10"</span> <span class="attr">p:child-ref</span>=<span class="string">"person2"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4spel的属性注入spring-30-以后"><a class="markdownIt-Anchor" href="#4spel的属性注入spring-30-以后"></a> 4）SpEL的属性注入(Spring 3.0 以后)</h5>
<p>SpEL：Spring Expression Language</p>
<p>参考：<a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#expressions">4. Spring Expression Language (SpEL)</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"person4"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.Person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"#&#123;person3.getName&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"#&#123;person3.getAge()&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"chile"</span> <span class="attr">value</span>=<span class="string">"#&#123;person3&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="数组-集合类型的属性注入方法"><a class="markdownIt-Anchor" href="#数组-集合类型的属性注入方法"></a> 数组、集合类型的属性注入方法</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] arrs;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; set;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; map;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setArrs</span><span class="params">(String[] arrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.arrs = arrs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSet</span><span class="params">(Set&lt;String&gt; set)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.set = set;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMap</span><span class="params">(Map&lt;String, String&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.map = map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(arrs + list + set + map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"collectionBean"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.CollectionBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- String[]数组的属性注入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arrs"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 普通类型的数组用value标签 --&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">value</span>&gt;</span>xinxing1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">value</span>&gt;</span>xinxing2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 自定义类型的数组用ref标签 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &lt;ref/&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- list集合的属性注入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">value</span>&gt;</span>xinxing1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">value</span>&gt;</span>xinxing2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- set集合的属性注入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"set"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">value</span>&gt;</span>xinxing1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">value</span>&gt;</span>xinxing2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- map集合的属性注入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"1"</span>, <span class="attr">value</span>=<span class="string">"xinxing1"</span>/&gt;</span></span><br><span class="line">444<span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"2"</span>, <span class="attr">value</span>=<span class="string">"xinxing2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="基于注解的属性注入"><a class="markdownIt-Anchor" href="#基于注解的属性注入"></a> 基于注解的属性注入</h3>
<h4 id="1导入6个核心包-aop开发包spring-aop-xxxreleasejar"><a class="markdownIt-Anchor" href="#1导入6个核心包-aop开发包spring-aop-xxxreleasejar"></a> 1）导入6个核心包 + AOP开发包：spring-aop-x.x.x.RELEASE.jar</h4>
<h4 id="2配置xml文件约束-2"><a class="markdownIt-Anchor" href="#2配置xml文件约束-2"></a> 2）配置XML文件约束</h4>
<p>导入<strong>context</strong>约束，参考官方文档：<a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#xsd-schemas-context">9.1.3. The context schema</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3开启注解扫描器"><a class="markdownIt-Anchor" href="#3开启注解扫描器"></a> 3）开启注解扫描器</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.xinxing.package"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="bean管理的常用注解"><a class="markdownIt-Anchor" href="#bean管理的常用注解"></a> Bean管理的常用注解</h4>
<h5 id="componentvalueid"><a class="markdownIt-Anchor" href="#componentvalueid"></a> @Component(value=“Id”)</h5>
<p>@Component作用在类上，用于给对应类的对象取一个Id。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(value=<span class="string">"Id"</span>) == &lt;bean id=<span class="string">"Id"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.xinxng.ClassName"</span>/&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Component如果不加value属性，默认以<strong>类名首字母小写</strong>作为对象名。</p>
<p>Spring提供三个和@Component功能一样的衍生注解，分别应用在不同的层次中：</p>
<p><strong>@Controller</strong>：作用在Web层的类上。</p>
<p><strong>@Service</strong>：作用在Service层的类上。</p>
<p><strong>@Repository</strong>：作用在Dao层的类上。</p>
<h5 id="scopevaluescope"><a class="markdownIt-Anchor" href="#scopevaluescope"></a> @Scope(value=“scope”)</h5>
<p>@Scope作用在类上，用于指定对象的作用范围：</p>
<ul>
<li>singleton：默认单例模式。</li>
<li>prototype：多例模式。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="meta">@Scope</span>(value=<span class="string">"prototype"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="valuevaluevalue"><a class="markdownIt-Anchor" href="#valuevaluevalue"></a> @Value(value=“value”)</h5>
<p>@Value作用在属性上，用于<strong>基本数据类型</strong>的注入，使用注解方式注入属性可以不提供set方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 相当于给name属性注入“xinxing”，而且可以省略setName()方法</span></span><br><span class="line">    <span class="meta">@Value</span>(value=<span class="string">"xinxing"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/*public void setName(String name) &#123;this.name = name&#125;*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="autowired-qualifiervalueid"><a class="markdownIt-Anchor" href="#autowired-qualifiervalueid"></a> @Autowired + @Qualifier(value=“ID”)</h5>
<p>@Autowired作用在属性上，用于对象属性的注入。</p>
<p>@Autowired注解单独使用时会按照类型自动注入对象，想要按照对象ID注入，必须在下面加@Qualifier(value=“ID”)注解，这两注解一起使用时可以完成按照对象ID注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span>(value=<span class="string">"userDao"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//如果单独使用@Autowired 它会按照类型自动装配</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(value=<span class="string">"userDao"</span>) <span class="comment">//这两个注解一起使用会按照名称“userDao”注入属性</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="resourcenameid"><a class="markdownIt-Anchor" href="#resourcenameid"></a> @Resource(name=“ID”)</h5>
<p>@Resource是java提供的一个注解，在javax.annotation包中，Spring框架也支持这个注解，可以完成@Autowired+@Qualifier(value=“ID”)一样的功能，@Resource可以在Ioc容器中按照对象ID找到对应对象然后注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"userDao"</span>)</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="postconstruct"><a class="markdownIt-Anchor" href="#postconstruct"></a> @PostConstruct</h5>
<p>@PostConstruct是java提供的注解在javax.annotation包中，作用在方法上指定对象的初始化方法，相当于bean标签里的init-method属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PastConstruct</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="predestroy"><a class="markdownIt-Anchor" href="#predestroy"></a> @PreDestroy</h5>
<p>@PreDestroy是java提供的注解在javax.annotation包中，作用在方法上指定对象的销毁方法，相当于bean标签的的destroy-method属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreDestroy</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="spring分模块开发的配置"><a class="markdownIt-Anchor" href="#spring分模块开发的配置"></a> Spring分模块开发的配置</h3>
<h4 id="在一个配置文件里引入多个配置文件"><a class="markdownIt-Anchor" href="#在一个配置文件里引入多个配置文件"></a> 在一个配置文件里引入多个配置文件</h4>
<p>applicationContext1.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext2.xml"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="加载配置文件的时候一次加载多个"><a class="markdownIt-Anchor" href="#加载配置文件的时候一次加载多个"></a> 加载配置文件的时候一次加载多个</h4>
<p>新建applicationContext对象的时候向里面传入多个配置文件，相当于调用接收可变参数的构造方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext1.xml"</span>, <span class="string">"applicationContext2.xml"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h3 id="spring整合web工程"><a class="markdownIt-Anchor" href="#spring整合web工程"></a> Spring整合Web工程</h3>
<p>我们将前端控制器配置好后开始往项目中整合Spring框架，原来在表现层中需要自己new一个服务层的服务对象，然后调用服务，现在这个服务层的服务对象应该交由Spring管理，所以我们执行下面的操作。</p>
<h4 id="1导入项目依赖"><a class="markdownIt-Anchor" href="#1导入项目依赖"></a> 1）导入项目依赖</h4>
<p>将Spring的4个核心包导入项目：Beans，Core，Context，SpEL，然后导入loging，log4j一共6个jar包。</p>
<h4 id="2创建applicationcontexxml配置文件并配置bean"><a class="markdownIt-Anchor" href="#2创建applicationcontexxml配置文件并配置bean"></a> 2）创建applicationContex.xml配置文件并配置bean</h4>
<p>在src下创建Spring配置文件applicationContext.xml，在配置文件中配置Service层相应业务的Bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerService"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.CustomerServiceImpl"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样我们就将Service层中的CustomerService对象交由Spring管理。</p>
<p>在表现层中我们需要使用CustomerService对象来调用它的服务，想要得到CustomerService对象，我们就需要创建一个Spring工厂，然后通过Spring工厂得到CustomerService对象，表现层代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        Customerservice cs = (CustomerService)ac.getBean(<span class="string">"customerService"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是表现层的控制器对象不是由Spring创建的，是由表现层框架创建的，每当网页发来一个请求，表现层框架就会调用这个Controller来处理请求，但是，每次来一个请求就需要加载Spring配置文件创建一次工厂来一个请求就需要创建一个工厂，这样会制造出很多无用的Sping工厂造成资源浪费，性能也是相当低的。</p>
<p>要解决上面的问题就需要用到Spring对Web项目的整合功能。</p>
<h4 id="3添加spring-web-xxxreleasejar包"><a class="markdownIt-Anchor" href="#3添加spring-web-xxxreleasejar包"></a> 3）添加spring-web-x.x.x.RELEASE.jar包</h4>
<h4 id="4配置servletcontext对象监听器"><a class="markdownIt-Anchor" href="#4配置servletcontext对象监听器"></a> 4）配置ServletContext对象监听器</h4>
<blockquote>
<p>Web容器在启动时会为每个Web应用创建一个ServletContext对象，ServletContext对象与Web应用具有同样的生命周期。ServletConfig对象中维护了ServletContext的引用，开发人员在编写Servlet时，可以通过ServletConfig.getServletContext方法获得ServletContext对象。由于一个Web应用中的所有Servlet共享同一个ServletContext对象，因此Servlet对象之间可以通过ServletContext对象来实现通讯。ServletContext对象通常也被称之为Context域对象</p>
<p>补充：一个类或一个控制器就相当于一个Servlet，一个部署在Tomcat上的war包就相当于一个Web应用，可见一个Web应用中可以包含很多Servlet。</p>
</blockquote>
<p>Spring的ServletContext对象监听器会在ServletContext对象被创建时执行我们配置好的方法，而ServletContext对象会在Web容器启动时被创建，所以通过配置ServletContext监听器我们可以在Web容器启动时加载Spring中配置好的对象，而且对象只被加载一次。</p>
<p>需要在web.xml中配置监听器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ContextLoaderListener默认情况下只能加载WEB-INF文件下的Spring配置文件，我们需要配置一下加载路径：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>补充：</p>
<ul>
<li>
<p>src不是classpath， WEB-INF/classes和WEB-INF/lib才是classpath，WEB-INF/ 是资源目录, 客户端不能直接访问。</p>
</li>
<li>
<p>WEB-INF/lib和WEB-INF/classes同属classpath，两者的访问优先级为: lib&gt;classes</p>
</li>
<li>
<p>WEB-INF/classes目录存放src目录里java文件编译之后的class文件，xml、properties等资源配置文件，这是一个定位资源的入口。</p>
</li>
<li>
<p>classpath 和 classpath* 区别：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">classpath：只会到你的class路径中查找找文件;</span><br><span class="line">classpath*：不仅包含class路径，还包括jar文件中(class路径)进行</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在Maven项目中这个classes文件被移到了target文件夹下，编译完成的class、xml和properties文件都被放到了target/classes文件里，classpath指的是target/classes文件夹。</p>
</li>
</ul>
</blockquote>
<h4 id="5从servletcontext中获取webapplicationcontext然后得到customerservice对象"><a class="markdownIt-Anchor" href="#5从servletcontext中获取webapplicationcontext然后得到customerservice对象"></a> 5）从ServletContext中获取WebApplicationContext，然后得到customerService对象。</h4>
<p>ServletContext监听器加载完配置文件后，会把相应的Web工厂对象放到ServletContext对象中去。修改前端控制器代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*ApplicationContext ac = new ClassPathXmlApplicationContext("applicationContext.xml");*/</span></span><br><span class="line">        ServletContext sc = ServletActionContext.getServletContext();</span><br><span class="line">        WebApplicationContext ac = WebApplicationContextUtils.getWebApplicationContext(sc);</span><br><span class="line">        Customerservice cs = (CustomerService)ac.getBean(<span class="string">"customerService"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>补充：Web应用处理业务流程：</p>
<p>客户在网页操作发起业务请求，用户数据从网页传递到表现层，表现层调用相应的Controller处理数据然后完成，比如在Controller中会调用服务层的服务，服务层返回后跳转到操作成功页面，然后数据会被传递到服务层，服务层对数据做相应的处理完成业务逻辑，如果需要，服务层会调用持久层的服务把数据传递到持久层，持久层将数据保存在数据库，最后完成整个业务流程。</p>
<p>数据会从表现层 =&gt; 服务层 =&gt; 持久层。</p>
</blockquote>
<hr />
<h3 id="spring整合junit单元测试"><a class="markdownIt-Anchor" href="#spring整合junit单元测试"></a> Spring整合Junit单元测试</h3>
<p>利用Spring Ioc向测试类中注入需要测试的类。</p>
<p>1）引入Junit的依赖包。</p>
<p>2）引入spring-test-x.x.x.RELEASE.jar包。</p>
<p>3）使用注解在测试类中引入需要测试的类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@ContextConfiguration("classpath:applicationContext.xml")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"userService"</span>)</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userService.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="aopaspect-oriented-programming面向切面编程"><a class="markdownIt-Anchor" href="#aopaspect-oriented-programming面向切面编程"></a> AOP(Aspect Oriented Programming)面向切面编程</h2>
<h3 id="aop的概念"><a class="markdownIt-Anchor" href="#aop的概念"></a> AOP的概念</h3>
<blockquote>
<p>AOP(Aspect-Oriented Programming)面向切面编程，我们知道，面向对象的特点是继承、多态和封装。而封装就要求将功能分散到不同的对象中去，这在软件设计中往往称为职责分配。实际上也就是说，让不同的类设计不同的方法。这样代码就分散到一个个的类中去了。这样做的好处是降低了代码的复杂程度，使类可重用。</p>
<p>但是人们也发现，在分散代码的同时，也增加了代码的重复性。什么意思呢？比如说，我们在两个类中，可能都需要在每个方法中做日志。按面向对象的设计方法，我们就必须在两个类的方法中都加入日志的内容。也许他们是完全相同的，但就是因为面向对象的设计让类与类之间无法联系，而不能将这些重复的代码统一起来。</p>
<p>也许有人会说，那好办啊，我们可以将这段代码写在一个独立的类独立的方法里，然后再在这两个类中调用。但是，这样一来，这两个类跟我们上面提到的独立的类就有耦合了，它的改变会影响这两个类。那么，有没有什么办法，能让我们在需要的时候，随意地加入代码呢？<strong>这种在运行时，动态地将代码切入到类的指定方法、指定位置上的编程思想就是面向切面的编程。</strong></p>
<p>一般而言，我们管切入到指定类指定方法的代码片段称为<strong>切面</strong>，而切入到哪些类、哪些方法则叫<strong>切入点</strong>。有了AOP，我们就可以把几个类共有的代码，抽取到一个切片中，等到需要时再切入对象中去，从而改变其原有的行为。</p>
<p>这样看来，AOP其实只是OOP的补充而已。OOP从横向上区分出一个个的类来，而AOP则从纵向上向对象中加入特定的代码。有了AOP，OOP变得立体了。如果加上时间维度，AOP使OOP由原来的二维变为三维了，由平面变成立体了。从技术上来说，AOP基本上是通过代理机制实现的。 AOP在编程历史上可以说是里程碑式的，对OOP编程是一种十分有益的补充。AOP采用横向抽取机制，取代了传统纵向继承体系结构，提高了代码的重用性。</p>
</blockquote>
<h3 id="aop的底层实现原理"><a class="markdownIt-Anchor" href="#aop的底层实现原理"></a> AOP的底层实现原理</h3>
<p>AOP底层使用动态代理技术实现，提供两种动态代理方式：</p>
<ol>
<li>基于JDK的动态代理：必须是面向接口的，只有实现了具体接口的类才能生成代理对象。</li>
<li>基于CGLIB的动态代理：对于没有实现接口的类，也可以产生代理，产生这个类的之类的方式。</li>
</ol>
<p>AOP中根据类是否实现接口来采用上面两种动态代理的方式。</p>
<h4 id="基于jdk的动态代理"><a class="markdownIt-Anchor" href="#基于jdk的动态代理"></a> 基于JDK的动态代理</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDatImpl</span> <span class="keyword">implements</span> <span class="title">UserDat</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"save user data..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"update user data..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需求：在UserDao的save()方法执行之前打印日志。由于UserDao是接口，所以我们可以使用基于JDK的动态代理。</p>
<p>首先创建一个工具类，类里使用Proxy类创建代理对象然后返回，Proxy中的静态方法newProxyInstance中必须要求传入目标对象实现的接口，所以使用JDK Proxy类实现动态代理要求目标对象必须要有实现的接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用JDK的方式生成代理对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProxyUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserDao <span class="title">getProxy</span><span class="params">(<span class="keyword">final</span> UserDao dao)</span> </span>&#123;</span><br><span class="line">        UserDao proxy = (UserDao)Proxy.newProxyInstance(dao.getClass().getClassLoader(), dao.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="comment">// 只要代理对象被调用，这个回调方法就会被执行</span></span><br><span class="line">            <span class="comment">// proxy代表当前生成的代理对象</span></span><br><span class="line">            <span class="comment">// method表示当前代理对象调用目标函数的方法</span></span><br><span class="line">            <span class="comment">// agrs表示method方法中传入的参数</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">// 增强目标对象中的save方法</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"save"</span>.equals(method.getName())) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"记录日志"</span>);</span><br><span class="line">                    <span class="comment">// 开启事务</span></span><br><span class="line">                    <span class="comment">// method.invoke(dao, args);</span></span><br><span class="line">                    <span class="comment">// 提交事务</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 让dao中的方法正常执行，method是代理对象调用目标对象中的方法</span></span><br><span class="line">                <span class="keyword">return</span> method.invoke(dao, args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 返回代理对象</span></span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDKProxyDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 原始方式</span></span><br><span class="line">        UserDao dao = <span class="keyword">new</span> UserDatImpl(); <span class="comment">// 目标对象</span></span><br><span class="line">        dao.save();</span><br><span class="line">        dao.update();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 代理方式</span></span><br><span class="line">        <span class="comment">// 使用工具类获取代理对象</span></span><br><span class="line">        UserDao proxy = MyProxyUtils.getProxy(dao); <span class="comment">// 代理对象</span></span><br><span class="line">        proxy.save(); <span class="comment">// 它会执行proxy里面的invoke()方法，不会执行dao中的save()方法。</span></span><br><span class="line">        proxy.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="基于cglib的动态代理"><a class="markdownIt-Anchor" href="#基于cglib的动态代理"></a> 基于CGLIB的动态代理</h4>
<p>Spring核心包spring-core-x.x.x.RELEASE.jar中包含CGLIB的开发包。CBLIB内部是使用生成子类的方法生成代理对象，所以不要求目标类实现接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCglibUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用cglib的方式生成代理对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Book <span class="title">getProxy</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">// 设置父类</span></span><br><span class="line">        enhancer.setSuperclass(book.getClass());</span><br><span class="line">        <span class="comment">// 设置回调函数</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">            <span class="comment">// 当代理对象被调用的时候，回调函数就会执行</span></span><br><span class="line">            <span class="comment">// proxy表示当前的代理对象</span></span><br><span class="line">            <span class="comment">// method表示代理对象调用目标函数的方法</span></span><br><span class="line">            <span class="comment">// args表示method中传入的参数</span></span><br><span class="line">            <span class="comment">// methodProxy表示目标函数method的代理方法</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object proxy, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">// 增强目标函数方法</span></span><br><span class="line">                <span class="keyword">if</span>(method.getName().equals(<span class="string">"save"</span>)) &#123;</span><br><span class="line">                    <span class="comment">// do something</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 正常执行目标函数的方法</span></span><br><span class="line">                <span class="keyword">return</span> methodProxy.invokeSuper(proxy, args)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 生成代理对象</span></span><br><span class="line">        Book proxy = (Book)enhancer.create();</span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CglibProxyDemo</span> </span>&#123;</span><br><span class="line">    <span class="function">publci <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 原始方式</span></span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.save();</span><br><span class="line">        book.update();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 代理方式</span></span><br><span class="line">        Book proxy = MyCglibUtils.getProxy(book);</span><br><span class="line">        proxy.save();</span><br><span class="line">        proxy.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="aop相关术语"><a class="markdownIt-Anchor" href="#aop相关术语"></a> AOP相关术语</h3>
<ul>
<li><strong>Aspect</strong>(切面)：切入点和我们对切入点做的增强功能形成了一个切面，切入点需要配置，增强功能需要我们自己编写。</li>
<li><strong>Join point</strong>(连接点)：一个类中的所有方法都可以成为连结点</li>
<li><strong>Advice</strong>(通知/增强)：我们对切入点添加的功能。</li>
<li><strong>Pointcut</strong>(切入点)：我们对一些方法(连接点)进行增强，这个增强的连结点就是切入点。</li>
<li><strong>Introduction</strong>(引介)：引介是一种特殊的通知，可以在运行期为类动态地添加一些方法或属性。</li>
<li><strong>Target object</strong>(目标对象)：我们要对其创建代理的对象。</li>
<li><strong>AOP proxy</strong>(代理)：代理对象，JDK动态代理对象或者CGLIB动态代理对象。</li>
<li><strong>Weaving</strong>(织入)：织入是一个过程，是指给目标对象的切入点添加新的功能，然后创建代理对象的过程。</li>
</ul>
<h3 id="基于aspectj的xml方式的aop开发"><a class="markdownIt-Anchor" href="#基于aspectj的xml方式的aop开发"></a> 基于AspectJ的XML方式的AOP开发</h3>
<h4 id="1导入项目依赖-2"><a class="markdownIt-Anchor" href="#1导入项目依赖-2"></a> 1）导入项目依赖</h4>
<p>6个核心开发包</p>
<p>2个AOP开发包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring-aop-x.x.x.RELEASE.jar</span><br><span class="line">com.springsource.org.aopalliance-x.x.x.jar</span><br></pre></td></tr></table></figure>
<p>2个AspectJ开发包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.springsource.org.aspectj.weaver-x.x.x.RELEASE.jar</span><br><span class="line">spring-aspects-x.x.x.RELEASE.jar</span><br></pre></td></tr></table></figure>
<h4 id="2配置xml文件约束-3"><a class="markdownIt-Anchor" href="#2配置xml文件约束-3"></a> 2）配置XML文件约束</h4>
<p>导入AOP约束，参考官方文档：<a href="https://docs.spring.io/spring/docs/5.0.7.RELEASE/spring-framework-reference/core.html#xsd-schemas-aop">9.1.2. The aop schema</a></p>
<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span> <span class="comment">&lt;!-- bean definitions here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3创建包结构编写接口和实现类"><a class="markdownIt-Anchor" href="#3创建包结构编写接口和实现类"></a> 3）创建包结构，编写接口和实现类</h4>
<p>CustomerDao.jave</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Interface CustomerDao &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CustomerDaoImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoImpl</span> <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>applicationContext.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"customerDao"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.xinxing.CustomerDaoImpl"</span>/&gt;</span><br></pre></td></tr></table></figure>
<h4 id="4编写切面类"><a class="markdownIt-Anchor" href="#4编写切面类"></a> 4）编写切面类</h4>
<p>需求：我们有一个CustomerDaoImpl类实现了CustomerDao接口的save(), update()方法，我们想要在save()方法执行前打印日志，现在需要编写增强代码。</p>
<p>切面类 MyAspectXml.java ，MyAspectXml类的对象应该交给IoC容器管理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectXml</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 通知/增强功能</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 记录日志</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将切面类交给容器管理。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置切面类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectXml"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.MyAspectXml"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5配置aop"><a class="markdownIt-Anchor" href="#5配置aop"></a> 5）配置AOP</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置AOP --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置切面：切入点 + 通知/增强(类型) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspectXml"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置前置通知：save()方法执行之前，增强方法log()先执行 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切入点表达式：execution(public void com.xinxing.CustomerDaoImpl.save()) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"log"</span> <span class="attr">pointcut</span>=<span class="string">"execution(public void com.xinxing.CustomerDaoImpl.save())"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="切入点表达式写法"><a class="markdownIt-Anchor" href="#切入点表达式写法"></a> 切入点表达式写法</h3>
<p>切入点表达式的固定格式如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution([修饰符] 返回值类型 包名.类名.方法名(参数))</span><br></pre></td></tr></table></figure>
<p>1）修饰符，如<code>public</code>，可以省略不写，其他 部分都不能省略。</p>
<p>2）返回值类型，<code>*</code>代表任意返回值类型。</p>
<p>3）包名，如 <code>com.xinxing</code>，有下面几种写法：</p>
<ul>
<li><code>com.*</code>表示在com包中搜索。</li>
<li><code>*..*</code>表示在任意包下搜索。</li>
</ul>
<p>4）类名，如<code>CustomerDaoImpl</code>，有下面几种写法：</p>
<ul>
<li><code>Customer*</code>表示以<code>Customer</code>开头的类名。</li>
<li><code>*DaoImpl</code>表示以<code>DaoImpl</code>结尾的类名</li>
</ul>
<p>5）方法名，如<code>save</code>，有下面几种写法：</p>
<ul>
<li><code>*</code>表示所有方法。</li>
<li><code>save*()</code>表示以save开头的方法。</li>
<li><code>*save()</code>表示以save结尾的方法。</li>
</ul>
<p>6）参数名，如<code>(Sring, int)</code>，有下面几种写法：</p>
<ul>
<li><code>(*)</code>表示任意的一个参数。</li>
<li><code>(..)</code>表示任意参数，相当于可变参数。</li>
</ul>
<h3 id="aop通知增强类型"><a class="markdownIt-Anchor" href="#aop通知增强类型"></a> AOP通知/增强类型</h3>
<h4 id="1before-前置通知"><a class="markdownIt-Anchor" href="#1before-前置通知"></a> 1）Before 前置通知</h4>
<p>在目标对象方法执行之前执行的增强方法。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"adviceMethod"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>应用：验证方法的传入参数。</p>
<h4 id="2after-后置通知"><a class="markdownIt-Anchor" href="#2after-后置通知"></a> 2）After 后置通知</h4>
<p>在目标对象方法执行之后执行的增强方法。如果目标对象方法出现异常，增强方法也会执行。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"adviceMethod"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>应用：释放资源。</p>
<h4 id="3after-returning-正常返回通知"><a class="markdownIt-Anchor" href="#3after-returning-正常返回通知"></a> 3）After-returning 正常返回通知</h4>
<p>目标对象方法正常返回后执行的增强方法。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"adviceMethod"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>应用：修改方法返回值。</p>
<h4 id="4after-throwing-异常返回通知"><a class="markdownIt-Anchor" href="#4after-throwing-异常返回通知"></a> 4）After-throwing 异常返回通知</h4>
<p>目标对象方法抛出异常后才执行增强方法。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"adviceMethod"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>应用：包装异常信息。</p>
<h4 id="5around-环绕通知"><a class="markdownIt-Anchor" href="#5around-环绕通知"></a> 5）Around 环绕通知</h4>
<p>在目标对象方法执行的前后执行增强方法，<strong>默认情况下目标对象的方法不执行</strong>，需要手动让目标对象的方法执行。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"around"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 环绕通知1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 手动执行目标对象方法</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        joinPoint.proceed();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 环绕通知2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>应用：事务管理，方法执行前开启事务，方法执行后提交事务。</p>
<h3 id="基于aspectj的注解方式的aop开发"><a class="markdownIt-Anchor" href="#基于aspectj的注解方式的aop开发"></a> 基于AspectJ的注解方式的AOP开发</h3>
<h4 id="1导入项目依赖-3"><a class="markdownIt-Anchor" href="#1导入项目依赖-3"></a> 1）导入项目依赖</h4>
<p>和Xml方式的一样。</p>
<h4 id="2配置xml文件约束-4"><a class="markdownIt-Anchor" href="#2配置xml文件约束-4"></a> 2）配置XML文件约束</h4>
<p>这个XML文件是最全的包含了注解、AOP和事务的约束。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line">4</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3创将包结构编写接口和实现类"><a class="markdownIt-Anchor" href="#3创将包结构编写接口和实现类"></a> 3）创将包结构，编写接口和实现类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> CustomerDaoImpl implements CustomerDao &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置目标对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerDao"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.CustomerDaoImpl"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.Runwith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@ContextConfiguration("classpath:applicationContext.xml")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"customerDao"</span>)</span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        customerDao.save();</span><br><span class="line">        customerDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4编写切面类-2"><a class="markdownIt-Anchor" href="#4编写切面类-2"></a> 4）编写切面类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectAnnotation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 记录日志</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将切面类交给容器管理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置切面类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectAnnotation"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.MyAspectAnnotation"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-添加注解"><a class="markdownIt-Anchor" href="#5-添加注解"></a> 5） 添加注解</h4>
<h5 id="1-在切面类上添加aspect注解"><a class="markdownIt-Anchor" href="#1-在切面类上添加aspect注解"></a> 1. 在切面类上添加@Aspect注解</h5>
<h5 id="2-在增强方法上添加通知类型注解"><a class="markdownIt-Anchor" href="#2-在增强方法上添加通知类型注解"></a> 2. 在增强方法上添加通知类型注解</h5>
<p><strong>@Before</strong> : 前置通知</p>
<p><strong>@After</strong> : 后置通知</p>
<p><strong>@AfterReturing</strong> : 正常返回通知</p>
<p><strong>@AfterThrowing</strong> : 异常返回通知</p>
<p><strong>@Around</strong> : 环绕通知</p>
<h5 id="3-在通知类型里设置切入点"><a class="markdownIt-Anchor" href="#3-在通知类型里设置切入点"></a> 3. 在通知类型里设置切入点</h5>
<p><code>value=&quot;execution(public void com.xinxing.CustomerDaoImpl.save())&quot;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspectj;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span>  <span class="comment">// 标注当前类为一个切面类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectAnnotation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 设置通知类型为Before，在目标方法执行之前执行，value设置切入点</span></span><br><span class="line">    <span class="meta">@Before</span>(value=<span class="string">"execution(public void com.xinxing.CustomerDaoImpl.save())"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 记录日志</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@After</span>(value=<span class="string">"execution(public void com.xinxing.CustomerDaoImpl.update())"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-自定义切入点"><a class="markdownIt-Anchor" href="#4-自定义切入点"></a> 4. 自定义切入点</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectAnnotation</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(value=<span class="string">"execution(public void com.xinxing.CustomerDaoImpl.save())"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fn</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span>(value=<span class="string">"MyAspectAnnotation.fn()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@After</span>(value=<span class="string">"MyAspectAnnotation.fn()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around</span>(value=<span class="string">"MyAspectAnnotation.fn()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 让目标对象执行</span></span><br><span class="line">            joinPoint.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStacktrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// do someting</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6开启自动代理"><a class="markdownIt-Anchor" href="#6开启自动代理"></a> 6）开启自动代理</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启自动代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="spring的jdbc模板技术"><a class="markdownIt-Anchor" href="#spring的jdbc模板技术"></a> Spring的JDBC模板技术</h2>
<h3 id="开发环境环境搭建"><a class="markdownIt-Anchor" href="#开发环境环境搭建"></a> 开发环境环境搭建</h3>
<h4 id="1引入相关依赖"><a class="markdownIt-Anchor" href="#1引入相关依赖"></a> 1）引入相关依赖</h4>
<p>6个Spring核心开发包</p>
<p>1个Spring-aop开发包</p>
<p>3个JDBC模板需要的jar包</p>
<ul>
<li>MySQL数据库驱动</li>
<li>Spring-jdbc.jar</li>
<li>Spring-tx.jar</li>
</ul>
<h4 id="2编写模板类"><a class="markdownIt-Anchor" href="#2编写模板类"></a> 2）编写模板类</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Spring管家提供了内置的连接池，如果不想使用内置连接池可以整合其他的连接池</span></span><br><span class="line">        DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">"jdbc:mysql://192.168.3.86/springdb"</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">"astro"</span>);</span><br><span class="line">        <span class="comment">// 创建模板类</span></span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate();</span><br><span class="line">        <span class="comment">// 设置连接池</span></span><br><span class="line">        template.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">// 完成操作</span></span><br><span class="line">        template.update(<span class="string">"insert into t_account values (null,?,?)"</span>, <span class="string">"xinxing"</span>, <span class="number">10000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3将jdbc连接池和模板类对象交给spring管理"><a class="markdownIt-Anchor" href="#3将jdbc连接池和模板类对象交给spring管理"></a> 3）将JDBC连接池和模板类对象交给Spring管理</h4>
<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置JDBC数据库连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://192.168.3.86/springdb"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"astro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置JDBC的模板类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4修改模板类使用ioc容器注入属性"><a class="markdownIt-Anchor" href="#4修改模板类使用ioc容器注入属性"></a> 4）修改模板类，使用IoC容器注入属性</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@ContextConfiguration("classpath:applicationContext.xml")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCTest01</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"jdbcTemplate"</span>)</span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">"insert into t_account values (null,?,?)"</span>, <span class="string">"xinxing1"</span>, <span class="number">20000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5整合dbcp连接池"><a class="markdownIt-Anchor" href="#5整合dbcp连接池"></a> 5）整合DBCP连接池</h4>
<p>导入两个依赖包:</p>
<ul>
<li>com.springsource.org.apache.commons.dbcp-x.x.x.osgi.jar</li>
<li>com.springsource.org.apache.commons.pool-x.x.x.jar</li>
</ul>
<p>在applicationContext.xml中配置DBCP连接池</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置DBCP连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp2.BasicDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://192.168.3.86/springdb"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"astro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="6整合c3p0连接池"><a class="markdownIt-Anchor" href="#6整合c3p0连接池"></a> 6）整合C3P0连接池</h4>
<p>导入依赖：</p>
<ul>
<li>com.springsource.com.mchange.v2.c3p0-x.x.x.x.jar</li>
</ul>
<p>在applicationContext.xml中配置C3P0连接池</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置C3P0连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://192.168.3.86/springdb"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"astro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="jdbc模板类中的常用方法"><a class="markdownIt-Anchor" href="#jdbc模板类中的常用方法"></a> JDBC模板类中的常用方法</h3>
<h4 id="update方法可以完成数据库的增删改操作"><a class="markdownIt-Anchor" href="#update方法可以完成数据库的增删改操作"></a> update()方法可以完成数据库的增删改操作</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    jdbcTemplate.update(<span class="string">"insert into t_account values (null,?,?)"</span>, <span class="string">"xinxing1"</span>, <span class="number">20000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    jdbcTemplate.update(<span class="string">"delete from t_account where id = ?"</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    jdbcTemplate.update(<span class="string">"update t_account set name = ? where id = ?"</span>, <span class="string">"xx"</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="queryforobject完成对单行数据查询"><a class="markdownIt-Anchor" href="#queryforobject完成对单行数据查询"></a> queryForObject完成对单行数据查询</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Account ac = jdbcTemplate.queryForObject(<span class="string">"select * from t_account where  id = ?"</span>, <span class="keyword">new</span> BeanMapper(), <span class="number">2</span>);</span><br><span class="line">    System.out.println(ac);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POJO类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoney</span><span class="params">(Double money)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>手动封装数据，创建BeanMapper类，实现RowMapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自己手动封装数据</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeanMapper</span> <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">Account</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 一行一行封装数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">mapRow</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Account ac = <span class="keyword">new</span> Account();</span><br><span class="line">        ac.setId(resultSet.getInt(<span class="number">1</span>));</span><br><span class="line">        ac.setName(resultSet.getString(<span class="number">2</span>));</span><br><span class="line">        ac.setMoney(resultSet.getDouble(<span class="number">3</span>));</span><br><span class="line">        <span class="keyword">return</span> ac;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="query完成多行数据的查询"><a class="markdownIt-Anchor" href="#query完成多行数据的查询"></a> query()完成多行数据的查询</h4>
<p>用匿名内部类的方法封装数据，和上面的一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Account&gt; list = jdbcTemplate.query(<span class="string">"select * from t_account"</span>, <span class="keyword">new</span> RowMapper&lt;Account&gt;() &#123;</span><br><span class="line">        <span class="comment">// 手动封装数据，一行一行封装</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Account <span class="title">mapRow</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">            Account ac = <span class="keyword">new</span> Account();</span><br><span class="line">            ac.setId(resultSet.getInt(<span class="number">1</span>));</span><br><span class="line">            ac.setName(resultSet.getString(<span class="number">2</span>));</span><br><span class="line">            ac.setMoney(resultSet.getDouble(<span class="number">3</span>));</span><br><span class="line">            <span class="keyword">return</span> ac;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="spring事务管理"><a class="markdownIt-Anchor" href="#spring事务管理"></a> Spring事务管理</h2>
<h3 id="事务的基本概念"><a class="markdownIt-Anchor" href="#事务的基本概念"></a> 事务的基本概念</h3>
<blockquote>
<p>1）事务：是一个操作序列，这些操作要么都执行，要么都不执行，它是一个不可分割的工作单位。</p>
<p>2）事务的特性ACID：</p>
<ul>
<li><strong>原子性（Atomicity）</strong>：事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行。</li>
<li><strong>一致性（Consistency）</strong>：事务应确保数据库的状态从一个一致状态转变为另一个一致状态。<em>一致状态</em>的含义是数据库中的数据应满足完整性约束。</li>
<li><strong>隔离性（Isolation）</strong>：多个事务并发执行时，一个事务的执行不应影响其他事务的执行。</li>
<li><strong>持久性（Durability）</strong>：已被提交的事务对数据库的修改应该永久保存在数据库中。</li>
</ul>
<p>3）如果不考虑隔离性，引发安全性问题</p>
<ul>
<li>读问题：
<ul>
<li>脏读：一个事务对数据进行了修改，修改还没有提交时，另外一个事务也访问这个数据，然后使用了这个数据。</li>
<li>不可重复读：在一个事务内多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。在第一个事务中的两次读数据之间，由于第二个事务的修改，第一个事务两次读到的的数据可能不一样的，称为是不可重复读。</li>
<li>幻读：第一个事务对一个表中全部数据行进行了修改，同时第二个事务向表中插入一行新数据。第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。</li>
</ul>
</li>
<li>写问题：
<ul>
<li>丢失更新</li>
</ul>
</li>
</ul>
<p>4）如何解决安全性问题</p>
<ul>
<li>读问题：设置数据库隔离级别。</li>
<li>写问题：悲观锁和乐观锁。</li>
</ul>
<p>5）事务隔离级别</p>
<ul>
<li>未提交读(Read Uncommitted)：允许脏读，也就是可能读取到其他会话中未提交事务修改的数据。</li>
<li><strong>提交读(Read Committed)</strong>：只能读取到已经提交的数据。Oracle等多数数据库默认都是该级别 (不重复读)。</li>
<li>可重复读(Repeated Read)：可重复读。在同一个事务内的查询都和事务开始时刻一致的，InnoDB默认级别。在SQL标准中，该隔离级别消除了不可重复读，但是还存在幻读。</li>
<li>串行读(Serializable)：完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">隔离级别</th>
<th style="text-align:center">脏读(Dirty Read)</th>
<th style="text-align:center">不可重复读(NonRepeatable Read)</th>
<th style="text-align:center">幻读(Phantom Read)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">未提交读(Read Uncommitted)</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">可能</td>
</tr>
<tr>
<td style="text-align:center">提交读(Read Committed)</td>
<td style="text-align:center">不可能</td>
<td style="text-align:center">可能</td>
<td style="text-align:center">可能</td>
</tr>
<tr>
<td style="text-align:center">可重复读(Repeated Read)</td>
<td style="text-align:center">不可能</td>
<td style="text-align:center">不可能</td>
<td style="text-align:center">可能</td>
</tr>
<tr>
<td style="text-align:center">串行读(Serializable)</td>
<td style="text-align:center">不可能</td>
<td style="text-align:center">不可能</td>
<td style="text-align:center">不可能</td>
</tr>
</tbody>
</table>
</blockquote>
<h3 id="spring事务管理相关api"><a class="markdownIt-Anchor" href="#spring事务管理相关api"></a> Spring事务管理相关API</h3>
<ol>
<li><strong>PlatformTransactionManager</strong>：平台事务管理器(真正管理事务的类)。该接口有具体的实现类，根据不同的持久层框架，需要选择不同的实现类。</li>
<li><strong>TransactionDefinition</strong>：事务定义信息(事务的隔离级别,传播行为,超时,只读)。</li>
<li><strong>ransactionStatus</strong>：事务的状态。</li>
</ol>
<p>PlatformTransactionManager根据TransactionDefinition定义的事务信息进行事务管理，在管理事务中产生一些状态记录到TransactionStatus中。</p>
<h4 id="platformtransactionmanager实现类和常用方法"><a class="markdownIt-Anchor" href="#platformtransactionmanager实现类和常用方法"></a> PlatformTransactionManager实现类和常用方法</h4>
<p>实现类：</p>
<ul>
<li><strong>DataSourceTransactionManager</strong>：使用Spring的JDBC模板或者MyBatis框架时使用。</li>
<li><strong>HibernateTransactionManager</strong>：使用Hibernate框架时使用。</li>
</ul>
<p>常用方法：</p>
<ul>
<li>void commit(TransactionStatus status)</li>
<li>TransactionStatus getTransaction(TransactionDefinition definition)</li>
<li>void rollback(TransactionStatus status)</li>
</ul>
<h4 id="transactiondefinition定义事务隔离级别和传播行为"><a class="markdownIt-Anchor" href="#transactiondefinition定义事务隔离级别和传播行为"></a> TransactionDefinition定义事务隔离级别和传播行为</h4>
<h5 id="事务隔离级别isolation"><a class="markdownIt-Anchor" href="#事务隔离级别isolation"></a> <strong>事务隔离级别（Isolation）</strong></h5>
<ol>
<li><strong>static int ISOLATION_DEFAULT</strong> ：采用数据库默认隔离级别。</li>
<li>static int ISOLATION_READ_UNCOMMITTED ：未提交读。</li>
<li>static int ISOLATION_READ_COMMITTED ：提交读。</li>
<li>static int ISOLATION_REPEATABLE_READ ：可重复读。</li>
<li>static int ISOLATION_SERIALIZABLE ：串行读。</li>
</ol>
<h5 id="事务传播行为propagation"><a class="markdownIt-Anchor" href="#事务传播行为propagation"></a> <strong>事务传播行为（Propagation）</strong></h5>
<p>解决Service层之间方法调用时事务的管理问题。</p>
<p>假设业务层有两个方法A和B，A中调用B方法，则有：</p>
<ol>
<li><strong>PROPAGATION_REQUIRED</strong>（默认值）：保证有事务。A中有事务，使用A中的事务。如果没有，B就会开启一个新的事务，将A包含进来，默认值！！<br />
. PROPAGATION_SUPPORTS	：保证支持事务。A中有事务，使用A中的事务。如果A中没有事务，那么B也不使用事务。</li>
<li>PROPAGATION_MANDATORY ：强制使用事务。A中有事务，使用A中的事务。如果A没有事务抛出异常。</li>
<li>PROPAGATION_REQUIRES_NEW ：保证使用一个新的事务。A中有事务，将A中的事务挂起，B创建一个新的事务。</li>
<li>PROPAGATION_NOT_SUPPORTED ：保证不支持事务。A中有事务，将A中的事务挂起。</li>
<li>PROPAGATION_NEVER ：保证没有事务。A中有事务，抛出异常。</li>
<li>PROPAGATION_NESTED ：使用嵌套型事务。当A执行之后，就会在这个位置设置一个保存点，如果B没有问题执行通过，如果B出现异常，运行客户根据需求回滚(选择回滚到保存点或者是最初始状态)。</li>
</ol>
<h3 id="应用搭建事务管理转账案例的环境"><a class="markdownIt-Anchor" href="#应用搭建事务管理转账案例的环境"></a> 应用：搭建事务管理转账案例的环境</h3>
<h4 id="1创建web工程引入依赖"><a class="markdownIt-Anchor" href="#1创建web工程引入依赖"></a> 1）创建Web工程，引入依赖：</h4>
<ul>
<li>6个IOC核心开发包。</li>
<li>4个AOP包。</li>
<li>1个C3P0包。</li>
<li>1个MySQL驱动包</li>
<li>2个JDBC事务包。</li>
<li>1个整合JUnit测试包。</li>
</ul>
<h4 id="2编写xml文件约束"><a class="markdownIt-Anchor" href="#2编写xml文件约束"></a> 2）编写XML文件约束</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">	http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3创建包结构和类"><a class="markdownIt-Anchor" href="#3创建包结构和类"></a> 3）创建包结构和类</h4>
<p>Interface com.xinxing.tx.AccountService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xinxing.tx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pay</span><span class="params">(<span class="keyword">int</span> outId, <span class="keyword">int</span> inId, <span class="keyword">double</span> money)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Class com.xinxing.tx.AccountServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xinxing.tx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(<span class="keyword">int</span> outId, <span class="keyword">int</span> inId, <span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 扣钱</span></span><br><span class="line">        accountDao.outMoney(outId, money);</span><br><span class="line">        <span class="comment">// 加钱</span></span><br><span class="line">        accountDao.inMoney(inId, money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Interface com.xinxing.tx.AccountDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xinxing.tx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">outMoney</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">double</span> money)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inMoney</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">double</span> money)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Class com.xinxing.tx.AccountDaoImpl</p>
<p>Spring提供了一个JdbcDaoSupport类里面可以根据数据库连接池自动为我们创建JdbcTemple模板类，可以直接继承该类简化开发。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xinxing.tx;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import org.springframework.jdbc.core.JdbcTemplate;</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.support.JdbcDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*private JdbcTemplate jdbcTemplate;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</span></span><br><span class="line"><span class="comment">        this.jdbcTemplate = jdbcTemplate;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 扣钱</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outMoney</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// jdbcTemplate.update()</span></span><br><span class="line">        <span class="keyword">this</span>.getJdbcTemplate().update(<span class="string">"update t_account set money = money - ? where id = ?"</span>, money, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加钱</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inMoney</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.getJdbcTemplate().update(<span class="string">"update t_account set money = money + ? where id = ?"</span>, money, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JdbcDaoSupport类中可以根据数据库连接池创建JdbcTemplate模板类，所以在配置的时候只需要配置DataSource数据库连接池，然后将该类注入到JdbcDaoSupport的dataSource属性中去就可以。</p>
<h4 id="4配置beans"><a class="markdownIt-Anchor" href="#4配置beans"></a> 4）配置beans</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置业务层和持久层 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.tx.AccountServiceImpl"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.xinxing.tx.AccountDaoImpl"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;property name="jdbcTemplate" ref="jdbcTemplate"/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置C3P0连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://192.168.3.86/springdb"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"astro"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5编写测试程序"><a class="markdownIt-Anchor" href="#5编写测试程序"></a> 5）编写测试程序</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line">@ContextConfiguration("classpath:applicationContext.xml")</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"accountService"</span>)</span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        accountService.pay(<span class="number">2</span>, <span class="number">3</span>, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>环境搭建完成。</p>
<h3 id="spring事务管理分类"><a class="markdownIt-Anchor" href="#spring事务管理分类"></a> Spring事务管理分类</h3>
<ol>
<li>Spring编程时事务管理（不推荐使用）：手动编写代码完成事务管理。</li>
<li>Spring声明式事务管理（底层采用AOP技术，推荐使用）：通过配置的方式完成事务管理。</li>
</ol>
<h3 id="spring编程式事务管理"><a class="markdownIt-Anchor" href="#spring编程式事务管理"></a> Spring编程式事务管理</h3>
<p>Spring为了简化事务管理的代码，提供了模板类 TransactionTemplate，所以手动编程的方式来管理事务，只需要使用该模板类即可。</p>
<h4 id="1配置平台事务管理器和连接池"><a class="markdownIt-Anchor" href="#1配置平台事务管理器和连接池"></a> 1）配置平台事务管理器和连接池</h4>
<p>Spring使用PlatformTransactionManager接口来管理事务，所以咱们需要使用到他的实现类：<strong>DataSourceTransactionManager</strong>或者<strong>HibernateTransactionManager</strong>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2配置事务模板"><a class="markdownIt-Anchor" href="#2配置事务模板"></a> 2）配置事务模板</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务管理的模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3在service中注入事务管理模板"><a class="markdownIt-Anchor" href="#3在service中注入事务管理模板"></a> 3）在Service中注入事务管理模板</h4>
<p>AccountServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionTemplate</span><span class="params">(TransactionTemplate transactionTemplate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.transactionTemplate = transactionTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.itheima.demo1.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span>/&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionTemplate"</span> <span class="attr">ref</span>=<span class="string">"transactionTemplate"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4在service层使用事务模板管理事务"><a class="markdownIt-Anchor" href="#4在service层使用事务模板管理事务"></a> 4）在Service层使用事务模板管理事务</h4>
<p>AccountServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入事务模板对象</span></span><br><span class="line"><span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransactionTemplate</span><span class="params">(TransactionTemplate transactionTemplate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.transactionTemplate = transactionTemplate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(<span class="keyword">final</span> String out, <span class="keyword">final</span> String in, <span class="keyword">final</span> <span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">    transactionTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 事务的执行，如果没有问题则提交奥，如果出现异常则回滚</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doInTransactionWithoutResult</span><span class="params">(TransactionStatus status)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// 扣钱</span></span><br><span class="line">            accountDao.outMoney(out, money);</span><br><span class="line">            <span class="keyword">int</span> a = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 加钱</span></span><br><span class="line">            accountDao.inMoney(in, money);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="spring声明式事务管理基于aop"><a class="markdownIt-Anchor" href="#spring声明式事务管理基于aop"></a> Spring声明式事务管理（基于AOP）</h3>
<p>声明式事务管理又分为两种：</p>
<ol>
<li>基于AspectJ的XML方式的事务管理</li>
<li>基于AspectJ的注解方式的事务管理</li>
</ol>
<h4 id="1-基于aspectj的xml方式的事务管理"><a class="markdownIt-Anchor" href="#1-基于aspectj的xml方式的事务管理"></a> 1. 基于AspectJ的XML方式的事务管理</h4>
<h5 id="1配置事务管理器"><a class="markdownIt-Anchor" href="#1配置事务管理器"></a> 1）配置事务管理器</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置平台事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2配置事务增强功能advice"><a class="markdownIt-Anchor" href="#2配置事务增强功能advice"></a> 2）配置事务增强功能（Advice）</h5>
<p>Spring中事务管理的切面类是现成的，我们只需要在xml文件中配置一下就可以使用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明式事务（采用XML配置文件的方式） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第一步 配置通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"myAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定哪些方法加事务，name属性可以使用通配符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"pay*"</span> <span class="attr">isolation</span>=<span class="string">"DEFAULT"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;tx:method&gt;</code>标签中可以有很多属性：</p>
<ul>
<li>name：必须有，指定哪些方法使用事务，可以用通配符表示如<code>pay*</code>表示所有以pay开头的方法。</li>
<li>propagation：事务传播行为。</li>
<li>isalation：事务隔离级别。</li>
<li>read-only：是否只读。</li>
<li>timout：超时信息。</li>
<li>rollback-for：发生哪些异常时回滚。</li>
<li>no-rollback-for：发生哪些异常时不回滚。</li>
</ul>
<h5 id="3配置aop"><a class="markdownIt-Anchor" href="#3配置aop"></a> 3）配置AOP</h5>
<p>在<code>&lt;aop:config&gt;</code>标签中，如果是自己编写的切面类要使用<code>&lt;aop:aspect&gt;</code>配置切面，如果使用Spring提供的切面类要使用<code>&lt;aop:advisor&gt;</code>配置切面。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第二步 配置AOP --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如果是自己编写的AOP，使用&lt;aop:aspect&gt;配置，如果使用Spring提供的AOP使用&lt;aop:advisor&gt;配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myAdvice"</span> <span class="attr">pointcut</span>=<span class="string">"execution(public void com.xinxing.tx.AccountServiceImpl.pay(int,int,double))"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>事务配置完成。</p>
<h4 id="2-基于aspectj的注解方式的事务管理重点最简单的方式"><a class="markdownIt-Anchor" href="#2-基于aspectj的注解方式的事务管理重点最简单的方式"></a> 2. 基于AspectJ的注解方式的事务管理（重点，最简单的方式）</h4>
<h5 id="1配置事务管理器-2"><a class="markdownIt-Anchor" href="#1配置事务管理器-2"></a> 1）配置事务管理器</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置平台事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2开启注解事务"><a class="markdownIt-Anchor" href="#2开启注解事务"></a> 2）开启注解事务</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启事务的注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="3在类或方法上添加transactional注解"><a class="markdownIt-Anchor" href="#3在类或方法上添加transactional注解"></a> 3）在类或方法上添加@Transactional注解</h5>
<ul>
<li>如果在类上加@Transactional，类中的所有方法就都有事务了。</li>
<li>如果在方法上加@Transactional，只有该方法有事务。</li>
</ul>
<p>和<code>&lt;tx:method&gt;</code>标签一样@Transactional同样可以设置事务的属性。</p>

    </div>

    
    
    
      


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/07/18/Computer-Science-%E5%B9%B6%E5%8F%91%E5%B9%B6%E8%A1%8C%E4%B8%B2%E8%A1%8C%E6%80%BB%E7%BB%93/" rel="prev" title="并发、并行、串行总结">
      <i class="fa fa-chevron-left"></i> 并发、并行、串行总结
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/07/19/Computer-Science-LRUCache%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/" rel="next" title="LRU Cache的原理及实现">
      LRU Cache的原理及实现 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#iocinversion-of-control控制反转"><span class="nav-number">1.</span> <span class="nav-text"> IoC(Inversion of Control)控制反转</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ioc的概念"><span class="nav-number">1.1.</span> <span class="nav-text"> IoC的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ioc的底层实现"><span class="nav-number">1.2.</span> <span class="nav-text"> IoC的底层实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring的工厂类"><span class="nav-number">1.3.</span> <span class="nav-text"> Spring的工厂类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#spring工厂类的结构"><span class="nav-number">1.3.1.</span> <span class="nav-text"> Spring工厂类的结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#最底层的两个实现类"><span class="nav-number">1.3.2.</span> <span class="nav-text"> 最底层的两个实现类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bean的创建"><span class="nav-number">1.4.</span> <span class="nav-text"> Bean的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1无参构造方法默认"><span class="nav-number">1.4.1.</span> <span class="nav-text"> 1）无参构造方法（默认）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2静态工厂实例化方式"><span class="nav-number">1.4.2.</span> <span class="nav-text"> 2）静态工厂实例化方式：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3实例化工厂实例化方式"><span class="nav-number">1.4.3.</span> <span class="nav-text"> 3）实例化工厂实例化方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bean的配置"><span class="nav-number">1.5.</span> <span class="nav-text"> Bean的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bean的idname配置"><span class="nav-number">1.5.1.</span> <span class="nav-text"> Bean的id，name配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bean生命周期的配置"><span class="nav-number">1.5.2.</span> <span class="nav-text"> Bean生命周期的配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bean的作用范围的配置"><span class="nav-number">1.5.3.</span> <span class="nav-text"> Bean的作用范围的配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于配置文件的属性注入"><span class="nav-number">1.6.</span> <span class="nav-text"> 基于配置文件的属性注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1导入6个spring核心开发包"><span class="nav-number">1.6.1.</span> <span class="nav-text"> 1）导入6个Spring核心开发包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2配置xml文件约束"><span class="nav-number">1.6.2.</span> <span class="nav-text"> 2）配置XML文件约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#普通类型属性注入方法"><span class="nav-number">1.6.3.</span> <span class="nav-text"> 普通类型属性注入方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1构造方法的属性注入"><span class="nav-number">1.6.3.1.</span> <span class="nav-text"> 1）构造方法的属性注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2set方法的属性注入"><span class="nav-number">1.6.3.2.</span> <span class="nav-text"> 2）set方法的属性注入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3p名称空间的属性注入spring-25-以后"><span class="nav-number">1.6.3.3.</span> <span class="nav-text"> 3）P名称空间的属性注入(Spring 2.5 以后)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4spel的属性注入spring-30-以后"><span class="nav-number">1.6.3.4.</span> <span class="nav-text"> 4）SpEL的属性注入(Spring 3.0 以后)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数组-集合类型的属性注入方法"><span class="nav-number">1.6.4.</span> <span class="nav-text"> 数组、集合类型的属性注入方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于注解的属性注入"><span class="nav-number">1.7.</span> <span class="nav-text"> 基于注解的属性注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1导入6个核心包-aop开发包spring-aop-xxxreleasejar"><span class="nav-number">1.7.1.</span> <span class="nav-text"> 1）导入6个核心包 + AOP开发包：spring-aop-x.x.x.RELEASE.jar</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2配置xml文件约束-2"><span class="nav-number">1.7.2.</span> <span class="nav-text"> 2）配置XML文件约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3开启注解扫描器"><span class="nav-number">1.7.3.</span> <span class="nav-text"> 3）开启注解扫描器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bean管理的常用注解"><span class="nav-number">1.7.4.</span> <span class="nav-text"> Bean管理的常用注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#componentvalueid"><span class="nav-number">1.7.4.1.</span> <span class="nav-text"> @Component(value&#x3D;“Id”)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#scopevaluescope"><span class="nav-number">1.7.4.2.</span> <span class="nav-text"> @Scope(value&#x3D;“scope”)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#valuevaluevalue"><span class="nav-number">1.7.4.3.</span> <span class="nav-text"> @Value(value&#x3D;“value”)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#autowired-qualifiervalueid"><span class="nav-number">1.7.4.4.</span> <span class="nav-text"> @Autowired + @Qualifier(value&#x3D;“ID”)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#resourcenameid"><span class="nav-number">1.7.4.5.</span> <span class="nav-text"> @Resource(name&#x3D;“ID”)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#postconstruct"><span class="nav-number">1.7.4.6.</span> <span class="nav-text"> @PostConstruct</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#predestroy"><span class="nav-number">1.7.4.7.</span> <span class="nav-text"> @PreDestroy</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring分模块开发的配置"><span class="nav-number">1.8.</span> <span class="nav-text"> Spring分模块开发的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在一个配置文件里引入多个配置文件"><span class="nav-number">1.8.1.</span> <span class="nav-text"> 在一个配置文件里引入多个配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加载配置文件的时候一次加载多个"><span class="nav-number">1.8.2.</span> <span class="nav-text"> 加载配置文件的时候一次加载多个</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring整合web工程"><span class="nav-number">1.9.</span> <span class="nav-text"> Spring整合Web工程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1导入项目依赖"><span class="nav-number">1.9.1.</span> <span class="nav-text"> 1）导入项目依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2创建applicationcontexxml配置文件并配置bean"><span class="nav-number">1.9.2.</span> <span class="nav-text"> 2）创建applicationContex.xml配置文件并配置bean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3添加spring-web-xxxreleasejar包"><span class="nav-number">1.9.3.</span> <span class="nav-text"> 3）添加spring-web-x.x.x.RELEASE.jar包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4配置servletcontext对象监听器"><span class="nav-number">1.9.4.</span> <span class="nav-text"> 4）配置ServletContext对象监听器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5从servletcontext中获取webapplicationcontext然后得到customerservice对象"><span class="nav-number">1.9.5.</span> <span class="nav-text"> 5）从ServletContext中获取WebApplicationContext，然后得到customerService对象。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring整合junit单元测试"><span class="nav-number">1.10.</span> <span class="nav-text"> Spring整合Junit单元测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#aopaspect-oriented-programming面向切面编程"><span class="nav-number">2.</span> <span class="nav-text"> AOP(Aspect Oriented Programming)面向切面编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#aop的概念"><span class="nav-number">2.1.</span> <span class="nav-text"> AOP的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aop的底层实现原理"><span class="nav-number">2.2.</span> <span class="nav-text"> AOP的底层实现原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基于jdk的动态代理"><span class="nav-number">2.2.1.</span> <span class="nav-text"> 基于JDK的动态代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基于cglib的动态代理"><span class="nav-number">2.2.2.</span> <span class="nav-text"> 基于CGLIB的动态代理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aop相关术语"><span class="nav-number">2.3.</span> <span class="nav-text"> AOP相关术语</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于aspectj的xml方式的aop开发"><span class="nav-number">2.4.</span> <span class="nav-text"> 基于AspectJ的XML方式的AOP开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1导入项目依赖-2"><span class="nav-number">2.4.1.</span> <span class="nav-text"> 1）导入项目依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2配置xml文件约束-3"><span class="nav-number">2.4.2.</span> <span class="nav-text"> 2）配置XML文件约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3创建包结构编写接口和实现类"><span class="nav-number">2.4.3.</span> <span class="nav-text"> 3）创建包结构，编写接口和实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4编写切面类"><span class="nav-number">2.4.4.</span> <span class="nav-text"> 4）编写切面类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5配置aop"><span class="nav-number">2.4.5.</span> <span class="nav-text"> 5）配置AOP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#切入点表达式写法"><span class="nav-number">2.5.</span> <span class="nav-text"> 切入点表达式写法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aop通知增强类型"><span class="nav-number">2.6.</span> <span class="nav-text"> AOP通知&#x2F;增强类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1before-前置通知"><span class="nav-number">2.6.1.</span> <span class="nav-text"> 1）Before 前置通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2after-后置通知"><span class="nav-number">2.6.2.</span> <span class="nav-text"> 2）After 后置通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3after-returning-正常返回通知"><span class="nav-number">2.6.3.</span> <span class="nav-text"> 3）After-returning 正常返回通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4after-throwing-异常返回通知"><span class="nav-number">2.6.4.</span> <span class="nav-text"> 4）After-throwing 异常返回通知</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5around-环绕通知"><span class="nav-number">2.6.5.</span> <span class="nav-text"> 5）Around 环绕通知</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于aspectj的注解方式的aop开发"><span class="nav-number">2.7.</span> <span class="nav-text"> 基于AspectJ的注解方式的AOP开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1导入项目依赖-3"><span class="nav-number">2.7.1.</span> <span class="nav-text"> 1）导入项目依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2配置xml文件约束-4"><span class="nav-number">2.7.2.</span> <span class="nav-text"> 2）配置XML文件约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3创将包结构编写接口和实现类"><span class="nav-number">2.7.3.</span> <span class="nav-text"> 3）创将包结构，编写接口和实现类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4编写切面类-2"><span class="nav-number">2.7.4.</span> <span class="nav-text"> 4）编写切面类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-添加注解"><span class="nav-number">2.7.5.</span> <span class="nav-text"> 5） 添加注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-在切面类上添加aspect注解"><span class="nav-number">2.7.5.1.</span> <span class="nav-text"> 1. 在切面类上添加@Aspect注解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-在增强方法上添加通知类型注解"><span class="nav-number">2.7.5.2.</span> <span class="nav-text"> 2. 在增强方法上添加通知类型注解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-在通知类型里设置切入点"><span class="nav-number">2.7.5.3.</span> <span class="nav-text"> 3. 在通知类型里设置切入点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-自定义切入点"><span class="nav-number">2.7.5.4.</span> <span class="nav-text"> 4. 自定义切入点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6开启自动代理"><span class="nav-number">2.7.6.</span> <span class="nav-text"> 6）开启自动代理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring的jdbc模板技术"><span class="nav-number">3.</span> <span class="nav-text"> Spring的JDBC模板技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#开发环境环境搭建"><span class="nav-number">3.1.</span> <span class="nav-text"> 开发环境环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1引入相关依赖"><span class="nav-number">3.1.1.</span> <span class="nav-text"> 1）引入相关依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2编写模板类"><span class="nav-number">3.1.2.</span> <span class="nav-text"> 2）编写模板类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3将jdbc连接池和模板类对象交给spring管理"><span class="nav-number">3.1.3.</span> <span class="nav-text"> 3）将JDBC连接池和模板类对象交给Spring管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4修改模板类使用ioc容器注入属性"><span class="nav-number">3.1.4.</span> <span class="nav-text"> 4）修改模板类，使用IoC容器注入属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5整合dbcp连接池"><span class="nav-number">3.1.5.</span> <span class="nav-text"> 5）整合DBCP连接池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6整合c3p0连接池"><span class="nav-number">3.1.6.</span> <span class="nav-text"> 6）整合C3P0连接池</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jdbc模板类中的常用方法"><span class="nav-number">3.2.</span> <span class="nav-text"> JDBC模板类中的常用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#update方法可以完成数据库的增删改操作"><span class="nav-number">3.2.1.</span> <span class="nav-text"> update()方法可以完成数据库的增删改操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#queryforobject完成对单行数据查询"><span class="nav-number">3.2.2.</span> <span class="nav-text"> queryForObject完成对单行数据查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#query完成多行数据的查询"><span class="nav-number">3.2.3.</span> <span class="nav-text"> query()完成多行数据的查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring事务管理"><span class="nav-number">4.</span> <span class="nav-text"> Spring事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#事务的基本概念"><span class="nav-number">4.1.</span> <span class="nav-text"> 事务的基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring事务管理相关api"><span class="nav-number">4.2.</span> <span class="nav-text"> Spring事务管理相关API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#platformtransactionmanager实现类和常用方法"><span class="nav-number">4.2.1.</span> <span class="nav-text"> PlatformTransactionManager实现类和常用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#transactiondefinition定义事务隔离级别和传播行为"><span class="nav-number">4.2.2.</span> <span class="nav-text"> TransactionDefinition定义事务隔离级别和传播行为</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#事务隔离级别isolation"><span class="nav-number">4.2.2.1.</span> <span class="nav-text"> 事务隔离级别（Isolation）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#事务传播行为propagation"><span class="nav-number">4.2.2.2.</span> <span class="nav-text"> 事务传播行为（Propagation）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用搭建事务管理转账案例的环境"><span class="nav-number">4.3.</span> <span class="nav-text"> 应用：搭建事务管理转账案例的环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1创建web工程引入依赖"><span class="nav-number">4.3.1.</span> <span class="nav-text"> 1）创建Web工程，引入依赖：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2编写xml文件约束"><span class="nav-number">4.3.2.</span> <span class="nav-text"> 2）编写XML文件约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3创建包结构和类"><span class="nav-number">4.3.3.</span> <span class="nav-text"> 3）创建包结构和类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4配置beans"><span class="nav-number">4.3.4.</span> <span class="nav-text"> 4）配置beans</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5编写测试程序"><span class="nav-number">4.3.5.</span> <span class="nav-text"> 5）编写测试程序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring事务管理分类"><span class="nav-number">4.4.</span> <span class="nav-text"> Spring事务管理分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring编程式事务管理"><span class="nav-number">4.5.</span> <span class="nav-text"> Spring编程式事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1配置平台事务管理器和连接池"><span class="nav-number">4.5.1.</span> <span class="nav-text"> 1）配置平台事务管理器和连接池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2配置事务模板"><span class="nav-number">4.5.2.</span> <span class="nav-text"> 2）配置事务模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3在service中注入事务管理模板"><span class="nav-number">4.5.3.</span> <span class="nav-text"> 3）在Service中注入事务管理模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4在service层使用事务模板管理事务"><span class="nav-number">4.5.4.</span> <span class="nav-text"> 4）在Service层使用事务模板管理事务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spring声明式事务管理基于aop"><span class="nav-number">4.6.</span> <span class="nav-text"> Spring声明式事务管理（基于AOP）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-基于aspectj的xml方式的事务管理"><span class="nav-number">4.6.1.</span> <span class="nav-text"> 1. 基于AspectJ的XML方式的事务管理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1配置事务管理器"><span class="nav-number">4.6.1.1.</span> <span class="nav-text"> 1）配置事务管理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2配置事务增强功能advice"><span class="nav-number">4.6.1.2.</span> <span class="nav-text"> 2）配置事务增强功能（Advice）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3配置aop"><span class="nav-number">4.6.1.3.</span> <span class="nav-text"> 3）配置AOP</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-基于aspectj的注解方式的事务管理重点最简单的方式"><span class="nav-number">4.6.2.</span> <span class="nav-text"> 2. 基于AspectJ的注解方式的事务管理（重点，最简单的方式）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1配置事务管理器-2"><span class="nav-number">4.6.2.1.</span> <span class="nav-text"> 1）配置事务管理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2开启注解事务"><span class="nav-number">4.6.2.2.</span> <span class="nav-text"> 2）开启注解事务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3在类或方法上添加transactional注解"><span class="nav-number">4.6.2.3.</span> <span class="nav-text"> 3）在类或方法上添加@Transactional注解</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Xing Xin"
      src="https://avatars0.githubusercontent.com/u/16800212?s=460&v=4">
  <p class="site-author-name" itemprop="name">Xing Xin</p>
  <div class="site-description" itemprop="description">Xing's Tech Blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/XinXingAstro" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;XinXingAstro" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xinxingastro@gmail.com" title="E-Mail → mailto:xinxingastro@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xing Xin</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">220k</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>




  <script>
    (function(d, w, c) {
      w.ChatraID = 'u5Jxaqvnnd33Bhyk3';
      var s = d.createElement('script');
      w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
      };
      s.async = true;
      s.src = 'https://call.chatra.io/chatra.js';
      if (d.head) d.head.appendChild(s);
    })(document, window, 'Chatra');
  </script>









  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://xings-blog.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://xinxingastro.github.io/2018/07/18/Java-Spring%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/";
    this.page.identifier = "2018/07/18/Java-Spring框架学习笔记/";
    this.page.title = "Spring框架学习笔记";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://xings-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
